<!DOCTYPE html>
<html>

<head>
    <style>
        .list-container {
            position: relative;
            height: 100%;
        }

        .list-background {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: var(--main-image);
            background-position: bottom;
            background-repeat: no-repeat;
            background-size: cover;
            filter: var(--main-filter);
        }

        .list-content {
            position: relative;
            height: 100%;
            overflow-y: auto;
        }

        /* Width */
        ::-webkit-scrollbar {
            width: 6px;
        }

        /* Track */
        ::-webkit-scrollbar-track {
            background: var(--clr-bground);
        }

        /* Handle */
        ::-webkit-scrollbar-thumb {
            background: var(--clr-btn-norm);
        }
    </style>

    <script>
        const items = [];
        const partSize = 20;
        const deltaSize = 5; //Bottom marging of list + border must be < 5px !!!

        let data = [];
        let fillFn;
        let indexFrom = 0;
        let indexTo = 0;
        let sampleElem;

        const getItemFunc = (data, ind) => item => {

            items.push(item);
            fillFn(data, ind, item);
        };

        const load = () => {

            for (let i = 0; i < partSize; i++)
                if (indexTo < data.length)
                    zxBase.copy(sampleElem.getId(), getItemFunc(data[indexTo++], indexTo));
        };

        zxBase.setInitHandler(() => {

            const rElem = zxBase.getHTML().children[1];

            rElem.addEventListener('scroll', () => {

                if (rElem.scrollTop + rElem.clientHeight > rElem.scrollHeight - deltaSize)
                    load();
            });
        });

        zxBase.setContent = (dt, fn) => {

            fillFn = fn;
            data = dt;

            sampleElem = zxBase.getAll()[0];
            sampleElem.hide();

            load();
        };

        /*        const items = [];

                //TODO: Сейчас вызывается только один раз! Сделать возможность удаления старого контента
                //Чтобы обновить инфу (без удаления старого), вызывающая функция должна заполмнить связку 
                //data<->item, и при изменении data, обновлять соответсвующий item
                zxBase.setContent = (dataArr, fillFn) => {

                    const sample = zxBase.getAll()[0];
                    sample.hide();

                    const getItemFunc = (data, ind) => item => {

                        items.push(item);
                        fillFn(data, ind, item);
                    };

                    dataArr.forEach((elem, ind) => zxBase.copy(sample.getId(), getItemFunc(elem, ind)));
                }; */
    </script>
</head>

<body>
    <div class="list-container">
        <div class="list-background"></div>
        <div class="list-content">
            <z-slot>{content}</z-slot>
        </div>
    </div>
</body>

</html>